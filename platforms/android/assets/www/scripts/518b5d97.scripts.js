"use strict";angular.module("lpApp",["ngRoute","ngResource"]).config(["$routeProvider",function(a){a.when("/",{resolve:{hasDSP:["$location","AppStorageService",function(a,b){var c=b.DSP.getAll();c?a.replace().url("/home"):a.replace().url("/welcome")}]}}).when("/get-started",{templateUrl:"views/public/get-started.html",resolve:{setAppLocation:["$rootScope",function(a){a.appLocation="Get Started"}]}}).when("/home",{templateUrl:"views/public/home.html",controller:"HomeCtrl",resolve:{getDSPList:["AppStorageService","$q","$location",function(a,b,c){var d=a.DSP.getAll();return d?d:(c.replace().url("/welcome"),!1)}]}}).when("/welcome",{templateUrl:"views/public/welcome.html",resolve:{setAppLocation:["$rootScope",function(a){a.appLocation="Welcome to Launchpad!"}]}}).when("/app-settings",{templateUrl:"views/public/app-settings.html",controller:"AppSettingsCtrl"}).when("/dsp-settings",{templateUrl:"views/public/settings/dsp-settings.html",controller:"DSPListCtrl",resolve:{getDSPList:["AppStorageService",function(a){return a.DSP.getAll()}]}}).when("/dsp-settings/:dsp",{templateUrl:"views/public/settings/dsp-settings-expand.html",controller:"DSPSettingsCtrl",resolve:{getDSP:["$route","$q","SystemService","AppStorageService",function(a,b,c,d){return d.DSP.get(a.current.params.dsp)}]}}).when("/get-dsp-form",{templateUrl:"views/utility/forms/get-dsp-form.html",controller:"GetDSPCtrl"}).when("/login/:dsp",{templateUrl:"views/public/login.html",controller:"LoginCtrl",resolve:{getDSPConfig:["$route","$http","$q","$location","AppStorageService",function(a,b,c,d,e){var f=e.DSP.get(a.current.params.dsp);return f.url===e.URL.get().currentURL&&d.replace().url("/launchpad"),f}]}}).when("/logout",{resolve:{logout:["$location","$rootScope","UserService","StorageService",function(a,b,c,d){d.sessionStorage.clear(),c.session().delete(),c.reset(),b.authenticated=!1,a.path("/")}]}}).when("/launchpad",{templateUrl:"views/launchpad.html",controller:"LaunchPadCtrl",resolve:{getGroups:["AppStorageService",function(a){return a.Apps.get()}],getDSPInfo:["AppStorageService",function(a){return a.Config.get()}]}}).when("/launchpad/:groupId",{templateUrl:"views/launchpad-group.html",controller:"LaunchPadGroupCtrl",resolve:{getApps:["$route","AppStorageService",function(a,b){return b.Apps.getAppsFromGroup(a.current.params.groupId)}],getDSPInfo:["AppStorageService",function(a){return a.Config.get()}]}}).when("/profile",{templateUrl:"views/profile.html",controller:"ProfileCtrl",resolve:{userInfo:["UserService","$q",function(a,b){var c=b.defer();return a.profile().get(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise}],userApps:["UserService","$q",function(a,b){function c(a){angular.forEach(a.app_groups,function(a){angular.forEach(a.apps,function(a){f.push(a)})})}function d(a){angular.forEach(a.no_group_apps,function(a){angular.forEach(a.apps,function(a){f.push(a)})})}var e=b.defer(),f=[];return a.session().get(function(a){c(a),d(a),e.resolve(f)},function(a){e.reject(a)}),e.promise}]}}).otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(a){a.defaults.headers.common["X-DreamFactory-Application-Name"]="launchpad"}]).config(["$provide",function(a){a.decorator("$exceptionHandler",["$delegate","$injector",function(a,b){return function(c,d){return b.invoke(["NotificationService",function(a){a.alertDialog(c.message)}]),a(c,d)}}])}]).run(["$route","$rootScope","$location","$http","UserService","AppStorageService",function(a,b,c,d,e,f){b.$on("$routeChangeStart",function(a,g){var h=["/launchpad/:groupId","/launchpad","/profile"],i=g.$$route.originalPath;angular.forEach(h,function(a){i===a&&(f.User.get().sessionId&&(d.defaults.headers.common["X-DreamFactory-Session-Token"]=f.User.get().sessionId),b.authenticated=f.User.get().authenticated,e.currentDSPUrl=f.URL.get().currentURL,e.session().get(function(){c.url()},function(){c.url("/")}))})})}]),angular.module("lpApp").controller("NavCtrl",["$scope","$rootScope",function(a,b){a.goBack=function(){return"Home"===b.appLocation?!1:(history.back(),void 0)}}]).controller("HomeCtrl",["$scope","$rootScope","getDSPList",function(a,b,c){b.appLocation="Home",a.dsps=c}]).controller("LoginCtrl",["$scope","$rootScope","$location","$q","AppStorageService","getDSPConfig","UserService","MessageService",function(a,b,c,d,e,f,g,h){b.appLocation="Login: "+f.name,a.currentDSP=f,a.user={},a.userLogin=function(b){a.$broadcast("user:userLogin",b)},a.guestLogin=function(){a.$broadcast("user:guestLogin")},a._userLogin=function(a){var b=d.defer();return g.session().save(a,function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise},a._guestLogin=function(){var a=d.defer();return g.session().get(function(b){a.resolve(b)},function(b){a.reject(b)}),a.promise},a.$on("user:userLogin",function(b,d){g.currentDSPUrl=a.currentDSP.url,a._userLogin(d).then(function(b){e.User.save(b),e.URL.save(a.currentDSP),a.currentDSP.config=b,e.Apps.save(a.currentDSP),e.Config.save(a.currentDSP),c.replace().url("/launchpad")},function(a){throw{message:"Unable to login: "+h.getFirstMessage(a)}})}),a.$on("user:guestLogin",function(){g.currentDSPUrl=a.currentDSP.url,a._guestLogin().then(function(b){console.log(b),e.User.save(b),e.URL.save(a.currentDSP),a.currentDSP.config=b,e.Apps.save(a.currentDSP),e.Config.save(a.currentDSP),c.replace().url("/launchpad")},function(a){throw{message:"Unable to login: "+h.getFirstMessage(a)}})})}]).controller("AppSettingsCtrl",["$scope","$rootScope",function(a,b){b.appLocation="Settings"}]).controller("DSPListCtrl",["$scope","$rootScope","getDSPList",function(a,b,c){b.appLocation="Settings: DSP List",a.dsps=c}]).controller("DSPSettingsCtrl",["$scope","$q","$rootScope","$location","getDSP","AppStorageService","SystemService","NotificationService",function(a,b,c,d,e,f,g,h){c.appLocation="Settings: "+e.name,a.currentDSP=e,a.UISettings=e.UISettings,a.saveDSPSettings=function(b){a.$broadcast("settings:save",b)},a.updateConfig=function(){a.$broadcast("settings:updateFromServer",a.currentDSP)},a.removeDSP=function(){a.$broadcast("settings:removeDSP")},a._getConfigFromServer=function(a){var c=b.defer();return g.config(a.url).get(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise},a.$on("settings:save",function(b,c){f.DSP.UISettings.save(a.currentDSP,c),h.alertDialog("Settings saved.")}),a.$on("settings:updateFromServer",function(b,c){a._getConfigFromServer(c).then(function(b){f.DSP.Config.save(a.currentDSP,b),h.alertDialog("Config Updated")},function(){throw{message:"Unable to connect to server"}})}),a.$on("settings:removeDSP",function(){var b=function(){f.DSP.delete(a.currentDSP)&&d.replace().url("/dsp-settings")},c={message:"You are about to delete "+a.currentDSP.name+" from your lists",confirmCallback:b,title:"Delete DSP"};h.confirmDialog(c)})}]).controller("GetDSPCtrl",["$scope","$q","$rootScope","$location","SystemService","AppStorageService",function(a,b,c,d,e,f){c.appLocation="Add A DSP",a.dsp={},a.getDSP=function(b){a.$broadcast("dsp:get",b)},a._getDSP=function(a){var c=b.defer();return e.config(a.url).get(function(a){c.resolve(a)},function(){c.reject(a)}),c.promise},a.$on("dsp:get",function(b,c){a._getDSP(c).then(function(a){c.config=a,c.UISettings={openRegistration:!1,guestUsers:!1,unGroupedApps:{}},f.DSP.save(c),d.url("/")},function(){throw{message:"Unable to connect "+c.name+" at "+c.url}})})}]),angular.module("lpApp").controller("ProfileCtrl",["$scope","$rootScope","userInfo","userApps","UserService","StringService","MessageService",function(a,b,c,d,e,f,g){b.appLocation="Profile: "+c.display_name,a.user=c,a.apps=d,console.log(a.user),a.submitUserProfile=function(b){console.log("User profile Submitted"),a.$broadcast("submit:profile",b)},a.cancelUserProfile=function(){a.$broadcast("cancel:profile")},a.verifyUserPassword=function(b){a.$broadcast("verify:password",b)},a._submitUserInfo=function(a){var b={default_app_id:a.default_app_id,display_name:a.display_name,email:a.email,first_name:a.first_name,last_name:a.last_name,phone:a.phone,security_question:a.security_question,security_answer:a.security_answer};e.profile().save(b,function(){return!0},function(a){throw new Error("Submit Profile Error: "+g.getFirstMessage(a))})},a._submitUserPassword=function(b){if(b.new_password&&a._verifyPasswordMatch){var c={old_password:b.old_password,new_password:b.new_password};e.password().save(c,function(){return!0},function(a){throw new Error("Submit Password Error: "+g.getFirstMessage(a))})}},a._verifyPasswordMatch=function(a){return f.areIdentical(a.new_password,a.verify_password)},a._resetUI=function(){a.user=e.profile().get()},a.$on("submit:profile",function(b,c){try{a._submitUserPassword(c),a._submitUserInfo(c),a._resetUI()}catch(d){}}),a.$on("verify:password",function(b,c){a.identical=a._verifyPasswordMatch(c)}),a.$on("cancel:profile",function(){console.log("Profile Change Canceled"),a.user=getInfo})}]),angular.module("lpApp").controller("LaunchPadCtrl",["$scope","$rootScope","getGroups","getDSPInfo",function(a,b,c,d){b.appLocation=d.name+": Groups",a.groups=c}]).controller("LaunchPadGroupCtrl",["$scope","$rootScope","getApps","getDSPInfo","AppLaunchService",function(a,b,c,d,e){b.appLocation=d.name+": "+c.name,a.group=c,a.launchApp=function(b){a.$broadcast("app:launch",b)},a.$on("app:launch",function(a,b){e.launchApp(b)})}]),angular.module("lpApp").controller("EventsCtrl",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("lpApp").factory("df",[function(){var a,b="http://localhost:8080/rest/api_docs/user",c="launchpad";return window.authorizations.add("X-DreamFactory-Application-Name",new ApiKeyAuthorization("X-DreamFactory-Application-Name",c,"header")),window.authorizations.add("Content-Type",new ApiKeyAuthorization("Content-Type","application/json","header")),a=new SwaggerApi({url:b,supportedSubmitMethods:["get","post","put","patch","merge","delete"]}),a.authorizations=window.authorizations,a.build(),a}]),angular.module("lpApp").factory("ObjectService",[function(){return{hasProperty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!0;return!1}}}]).factory("UrlService",[function(){return{makeSlug:function(a){return a.toLowerCase().split(" ").join("-")}}}]).factory("StringService",[function(){return{makeExcerpt:function(a,b){var c=a.split(" ",b).join(" ");return a.split(" ").length>=b?c+"...":a},makeSlug:function(a){return a.toLowerCase().split(" ").join("-")},areIdentical:function(a,b){function c(a,b){return a.length==b.length}function d(a,b){for(var c=Math.min(a.length,b.length),d=0;c>d;d++)if(a.charAt(d)!==b.charAt(d))return!1;return!0}return a=a||"",b=b||"",c(a,b)&&d(a,b)?!0:!1},getOriginFromString:function(a){return a.split("/",3).join("/")}}}]).factory("MessageService",[function(){return{getFirstMessage:function(a){return a.data.error[0].message},getAllMessages:function(){}}}]).factory("AppStorageService",["StorageService","StringService","ObjectService",function(a,b,c){return{DSP:{save:function(c){var d=a.localStorage.get("DSPList")||{},e=d.counter||0;if(e++,d.counter=e,c.id=d.counter,c.slug=b.makeSlug(c.name),d.platforms=d.platforms||{},d.platforms[c.id]=c,a.localStorage.save("DSPList",d))return!0;throw{message:"Unable to save DSP "+c.name}},get:function(b){var c=a.localStorage.get("DSPList");if(c.platforms[b])return c.platforms[b];throw{message:"Unable to find DSP"+b}},update:function(){},"delete":function(b){var c=a.localStorage.get("DSPList");if(c.platforms[b.id])return delete c.platforms[b.id],a.localStorage.save("DSPList",c),!0;throw{message:"Unable to delete DSP"+b.name+" with id of "+b.id}},getAll:function(){var b=a.localStorage.get("DSPList");return c.hasProperty(b.platforms)?b.platforms:!1},Config:{save:function(b,c){var d=a.localStorage.get("DSPList");if(d.platforms[b.id])return d.platforms[b.id].config=c,a.localStorage.save("DSPList",d),!0;throw{message:"Unable to save "+b.name+" settings"}}},UISettings:{save:function(b,c){var d=a.localStorage.get("DSPList");if(d.platforms[b.id])return d.platforms[b.id].UISettings=c,a.localStorage.save("DSPList",d),!0;throw{message:"Unable to save "+b.name+" UI settings"}}},UserSettings:{save:function(b,c){var d=a.localStorage.get("DSPList");if(d.platforms[b.id])return d.platforms[b.id].UserSettings=c,a.localStorage.save("DSPList",d),!0;throw{message:"Unable to save "+b.name+" User settings"}}}},User:{save:function(b){var c=a.sessionStorage.get("User")||{};if(c.sessionId=b.session_id,c.displayName=b.display_name,c.authenticated=!0,a.sessionStorage.save("User",c))return!0;throw{message:"Unable to set User "+b.displayName}},get:function(){return a.sessionStorage.get("User")}},URL:{save:function(b){var c=a.sessionStorage.get("URL")||{};if(c.currentURL=b.url,a.sessionStorage.save("URL",c))return!0;throw{message:"Unable to save "+b.name+" settings"}},get:function(){return a.sessionStorage.get("URL")}},Apps:{save:function(b){var c=a.sessionStorage.get("Apps")||{},d={};if(c.appGroups=b.config.app_groups,d.name=b.UISettings.unGroupedApps.name||"UnGrouped Apps",d.id=b.UISettings.unGroupedApps.id||0,d.description=b.UISettings.unGroupedApps.description||"Apps not assigned to a group.",d.apps=b.config.no_group_apps,c.appGroups.push(d),a.sessionStorage.save("Apps",c))return!0;throw{message:"Unable to save Apps to session."}},get:function(){return a.sessionStorage.get("Apps")},getAppsFromGroup:function(b){var c=a.sessionStorage.get("Apps"),d=[];return angular.forEach(c.appGroups,function(a){a.id==b&&(d=a)}),d}},Config:{save:function(b){if(a.sessionStorage.save("Config",b))return!0;throw{message:"Unable to save Config to session."}},get:function(){return a.sessionStorage.get("Config")}}}}]).factory("StorageService",[function(){return{localStorage:{save:function(a,b){return"string"!=typeof b&&(b=angular.toJson(b)),localStorage.setItem(a,b),!0},get:function(a){var b=localStorage.getItem(a);if(!b)return!1;try{return b=angular.fromJson(b)}catch(c){return b}},getObject:function(a){return JSON.parse(localStorage.getItem(a))},"delete":function(a){localStorage.removeItem(a)},clear:function(){localStorage.clear()},howMany:function(){return localStorage.length()},getAll:function(){var a={};return angular.forEach(localStorage,function(b,c){a[c]=b}),a}},sessionStorage:{save:function(a,b){return"string"!=typeof b&&(b=angular.toJson(b)),sessionStorage.setItem(a,b),!0},get:function(a){var b=sessionStorage.getItem(a);if(!b)return!1;try{return b=angular.fromJson(b)}catch(c){return b}},getObject:function(a){return JSON.parse(sessionStorage.getItem(a))},"delete":function(a){sessionStorage.removeItem(a)},clear:function(){sessionStorage.clear()},howMany:function(){return sessionStorage.length()},getAll:function(){var a={};return angular.forEach(sessionStorage,function(b,c){a[c]=b}),a}}}}]).factory("AppLaunchService",[function(){var a={};return{launchApp:function(b){if(a[b.id]=window.open(b.launch_url,b.name,"location=yes,menubar=yes,titlebar=yes"),a[b.id])return!0;throw{message:"Unable to launch "+b.name}},reopenApp:function(b){if(a[b.id].show())return!0;throw{message:"Unable to ReOpen "+b.name}},closeApp:function(){},hideApp:function(){},hideAppContainer:function(){}}}]).factory("UserService",["$resource","$q","AppStorageService",function(a){return{currentDSPUrl:"",session:function(){return a(this.currentDSPUrl+"/rest/user/session")},profile:function(){return a(this.currentDSPUrl+"/rest/user/profile")},password:function(){return a(this.currentDSPUrl+"/rest/user/password")},register:function(){return a(this.currentDSPUrl+"/rest/user/password")},reset:function(){this.currentDSPUrl=null}}}]).factory("SystemService",["$resource",function(a){return{config:function(b){return a(b+"/rest/system/config")}}}]).factory("NotificationService",["CordovaReady","$rootScope",function(a,b){function c(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}return{alertDialog:a(function(a,c,d,e){navigator.notification.alert(a,function(){c&&b.$apply(function(){c.call()})},d,e)}),confirmDialog:a(function(a){function d(){return!0}var e={message:"Are you sure you want to do this?",confirmCallback:d,title:"Confirm",buttonLabels:["OK","Cancel"]};a=c(e,a),navigator.notification.confirm(a.message,function(c){1===c&&b.$apply(function(){a.confirmCallback.call()})},a.title,a.buttonLabels)})}}]).factory("CordovaReady",[function(){return function(a){var b=[],c=function(){b.push(Array.prototype.slice.call(arguments))};return document.addEventListener("deviceready",function(){b.forEach(function(b){a.apply(this,b)}),c=a},!1),function(){return c.apply(this,arguments)}}}]),angular.module("lpApp").directive("locationText",["$rootScope",function(){return{restrict:"E",scope:{locationText:"=location"},template:"{{locationText}}"}}]);